<div class="flex flex-col items-center col-span-1 h-full">
	<form
		id="subscriptionForm"
		class="bg-[#FEEAFA] dark:bg-[#CBC0D3] p-6 rounded-xl w-full max-w-lg h-full text-center card"
	>
		<h2
			class="flex font-semibold text-sm text-zinc-900 dark:text-zinc-100"
		>
			<svg
				viewBox="0 0 24 24"
				fill="none"
				stroke-width="1.5"
				stroke-linecap="round"
				stroke-linejoin="round"
				aria-hidden="true"
				class="flex-none w-6 h-6"
			>
				<path
					d="M2.75 7.75a3 3 0 0 1 3-3h12.5a3 3 0 0 1 3 3v8.5a3 3 0 0 1-3 3H5.75a3 3 0 0 1-3-3v-8.5Z"
					class="fill-zinc-100 stroke-zinc-400 dark:fill-zinc-100/10 dark:stroke-zinc-500"
				></path>
				<path
					d="m4 6 6.024 5.479a2.915 2.915 0 0 0 3.952 0L20 6"
					class="stroke-zinc-400 dark:stroke-zinc-500"
				></path>
			</svg>
			<span class="ml-3">Wanna know more?</span>
		</h2>
		<p
			class="mt-2 text-sm text-zinc-600 dark:text-zinc-400"
		>
			Leave your mail to stay in touch.
		</p>
		<div class="flex mt-6">
			<input
				type="email"
				placeholder="Email address"
				aria-label="Email address"
				required
				id="emailInput"
				class="flex-auto border-zinc-900/10 dark:border-zinc-700 bg-white dark:bg-zinc-700/[0.15] shadow-md shadow-zinc-800/5 px-3 py-[calc(theme(spacing.2)-1px)] border focus:border-teal-500 dark:focus:border-teal-400 rounded-md focus:ring-4 focus:ring-teal-500/10 dark:focus:ring-teal-400/10 min-w-0 dark:placeholder:text-zinc-500 placeholder:text-zinc-400 sm:text-sm dark:text-zinc-200 appearance-none focus:outline-none"
			/>
			<button
				type="submit"
				id="submitButton"
				class="inline-flex flex-none justify-center items-center gap-2 bg-zinc-800 hover:bg-zinc-700 dark:hover:bg-zinc-600 active:bg-zinc-800 dark:active:bg-zinc-700 dark:bg-zinc-700 ml-4 px-3 py-2 rounded-md font-semibold text-sm text-zinc-100 active:text-zinc-100/70 dark:active:text-zinc-100/70 transition active:transition-none outline-offset-2"
			>
				Send
			</button>
		</div>
		<div
			id="successMessage"
			class="hidden mt-2 text-green-500 text-sm"
		>
			Thanks for subscribing! You'll hear from us
			soon.
		</div>
		<div
			id="errorMessage"
			class="hidden mt-2 text-red-500 text-sm"
		>
		</div>
	</form>
</div>

<script>
	const form = document.getElementById(
		"subscriptionForm",
	) as HTMLFormElement;
	const emailInput = document.getElementById(
		"emailInput",
	) as HTMLInputElement;
	const submitButton = document.getElementById(
		"submitButton",
	) as HTMLButtonElement;
	const errorMessage = document.getElementById(
		"errorMessage",
	) as HTMLDivElement;
	const successMessage = document.getElementById(
		"successMessage",
	) as HTMLDivElement;

	form.addEventListener("submit", async (e) => {
		e.preventDefault();

		// Reset state
		errorMessage.classList.add("hidden");
		successMessage.classList.add("hidden");
		submitButton.disabled = true;
		submitButton.textContent = "Sending...";

		try {
			const response = await fetch("/api/subscribe", {
				method: "POST",
				headers: {
					"Content-Type": "application/json",
				},
				body: JSON.stringify({
					email: emailInput.value,
				}),
			});

			const data = await response.json();

			if (!response.ok) {
				throw new Error(
					data.message || "Subscription failed",
				);
			}

			// Show success message
			successMessage.classList.remove("hidden");
			form.reset();
		} catch (err) {
			errorMessage.textContent =
				err instanceof Error
					? err.message
					: "Something went wrong. Please try again.";
			errorMessage.classList.remove("hidden");
		} finally {
			submitButton.disabled = false;
			submitButton.textContent = "Send";
		}
	});
</script>